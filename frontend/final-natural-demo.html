<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Natural Butterfly Reader</title>
    <link rel="stylesheet" href="css/butterfly-reader.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 20px; background: #f0f4f8; }
        .demo-container { max-width: 800px; margin: 2rem auto; padding: 2rem; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .demo-title { text-align: center; color: #2d3748; margin-bottom: 2rem; }
        .demo-content { font-size: 1.1rem; line-height: 1.8; color: #4a5568; }
        .controls { text-align: center; margin: 2rem 0; }
        .btn { background: #667eea; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; margin: 0 10px; font-size: 16px; }
        .btn:hover { background: #5a67d8; }
        .btn.playing { background: #f093fb; }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 class="demo-title">ü¶ã Final Natural Voice Test</h1>
        
        <div class="controls">
            <button id="playBtn" class="btn">‚ñ∂Ô∏è Start Natural Reading</button>
            <button id="resetBtn" class="btn">üîÑ Reset</button>
        </div>

        <div class="demo-content" id="storyContent">
            <p>Arjun stared at his computer screen in frustration. For the third time that morning, he had typed "Write marketing copy" into ChatGPT, and for the third time, he got generic content.</p>

            <p>"This is supposed to be revolutionary AI," he muttered, deleting another bland paragraph. His deadline was approaching fast, and his boss Rajesh was expecting compelling copy for their new project management software.</p>

            <p>Just then, his colleague Priya walked by his desk. She noticed his frustrated expression and the ChatGPT tab open on his screen. "Having trouble with AI prompts?" she asked with a knowing smile.</p>

            <p>"It's like talking to a robot that doesn't understand context," Arjun complained. "I ask for marketing copy, and it gives me something so generic it could be selling toothpaste or rocket ships."</p>

            <p>Priya pulled up a chair. "That's because you're not speaking its language yet. AI is incredibly powerful, but it needs the right instructions. Let me show you something that changed everything for me."</p>
        </div>
    </div>

    <script>
        class NaturalButterflyReader {
            constructor() {
                this.isPlaying = false;
                this.currentSentenceIndex = 0;
                this.sentences = [];
                this.butterfly = null;
                this.init();
            }
            
            init() {
                this.parseSentences();
                this.createButterfly();
                this.setupControls();
            }
            
            parseSentences() {
                const content = document.getElementById('storyContent');
                const paragraphs = content.querySelectorAll('p');
                
                paragraphs.forEach(p => {
                    const text = p.textContent;
                    const sentences = text.split(/[.!?]+/).filter(s => s.trim());
                    
                    sentences.forEach(sentence => {
                        if (sentence.trim()) {
                            this.sentences.push({
                                text: sentence.trim() + '.',
                                element: p
                            });
                        }
                    });
                });
            }
            
            createButterfly() {
                this.butterfly = document.createElement('div');
                this.butterfly.innerHTML = 'ü¶ã';
                this.butterfly.style.cssText = `
                    position: absolute;
                    font-size: 24px;
                    z-index: 100;
                    transition: all 0.8s ease;
                    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
                `;
                document.body.appendChild(this.butterfly);
            }
            
            setupControls() {
                document.getElementById('playBtn').onclick = () => this.toggleReading();
                document.getElementById('resetBtn').onclick = () => this.reset();
            }
            
            async toggleReading() {
                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.start();
                }
            }
            
            async start() {
                this.isPlaying = true;
                const btn = document.getElementById('playBtn');
                btn.innerHTML = '‚è∏Ô∏è Pause';
                btn.classList.add('playing');
                
                await this.readSentences();
            }
            
            pause() {
                this.isPlaying = false;
                speechSynthesis.cancel();
                const btn = document.getElementById('playBtn');
                btn.innerHTML = '‚ñ∂Ô∏è Continue';
                btn.classList.remove('playing');
            }
            
            async readSentences() {
                for (let i = this.currentSentenceIndex; i < this.sentences.length; i++) {
                    if (!this.isPlaying) break;
                    
                    const sentence = this.sentences[i];
                    
                    // Move butterfly to sentence
                    this.moveButterflyTo(sentence.element);
                    
                    // Highlight sentence
                    this.highlightSentence(sentence.element);
                    
                    // Speak entire sentence naturally
                    await this.speakSentence(sentence.text);
                    
                    // Wait a bit between sentences
                    await this.wait(800);
                    
                    this.currentSentenceIndex = i + 1;
                }
                
                if (this.isPlaying) {
                    this.pause();
                }
            }
            
            moveButterflyTo(element) {
                const rect = element.getBoundingClientRect();
                this.butterfly.style.left = (rect.left - 40) + 'px';
                this.butterfly.style.top = (rect.top + window.scrollY + 10) + 'px';
            }
            
            highlightSentence(element) {
                // Remove previous highlights
                document.querySelectorAll('p').forEach(p => {
                    p.style.background = '';
                });
                
                // Highlight current
                element.style.background = 'linear-gradient(120deg, #a8edea 0%, #fed6e3 100%)';
                element.style.borderRadius = '8px';
                element.style.padding = '12px';
                
                // Scroll into view
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            async speakSentence(text) {
                return new Promise((resolve) => {
                    if (!this.isPlaying) {
                        resolve();
                        return;
                    }
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Get best voice
                    const voices = speechSynthesis.getVoices();
                    const bestVoice = voices.find(v => v.name.includes('Google') && v.lang.startsWith('en')) ||
                                   voices.find(v => v.name.includes('Microsoft') && v.lang.startsWith('en')) ||
                                   voices.find(v => v.lang.startsWith('en'));
                    
                    if (bestVoice) utterance.voice = bestVoice;
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    utterance.onend = resolve;
                    utterance.onerror = resolve;
                    
                    speechSynthesis.speak(utterance);
                });
            }
            
            wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            reset() {
                this.pause();
                this.currentSentenceIndex = 0;
                
                // Remove highlights
                document.querySelectorAll('p').forEach(p => {
                    p.style.background = '';
                    p.style.borderRadius = '';
                    p.style.padding = '';
                });
                
                // Reset butterfly
                if (this.sentences.length > 0) {
                    this.moveButterflyTo(this.sentences[0].element);
                }
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for voices to load
            if (speechSynthesis.getVoices().length > 0) {
                new NaturalButterflyReader();
            } else {
                speechSynthesis.onvoiceschanged = () => {
                    new NaturalButterflyReader();
                };
            }
        });
    </script>
</body>
</html>
