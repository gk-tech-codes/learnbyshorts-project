<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://www.google-analytics.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    
    <title>Input Sanitization Test - LearnByShorts</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .pass { background: #d4edda; border-color: #c3e6cb; }
        .fail { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 3px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error-message { color: #dc3545; font-size: 14px; margin-top: 5px; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>🔒 Input Sanitization & Validation Test</h1>
    
    <div class="test">
        <h3>🧪 Test Contact Form Security</h3>
        <form id="testForm">
            <label>Name:</label>
            <input type="text" id="name" name="name" placeholder="Try: John<script>alert('xss')</script>">
            
            <label>Email:</label>
            <input type="email" id="email" name="email" placeholder="Try: test@example.com or invalid-email">
            
            <label>Message:</label>
            <textarea id="message" name="message" rows="4" placeholder="Try: <script>alert('xss')</script> or javascript:alert('xss')"></textarea>
            
            <button type="submit">Test Submit</button>
        </form>
        
        <div id="testResults" class="result" style="display: none;">
            <h4>Sanitized Results:</h4>
            <div id="sanitizedOutput"></div>
        </div>
    </div>
    
    <div class="test">
        <h3>🛡️ Security Features Tested:</h3>
        <ul>
            <li>✅ <strong>XSS Prevention:</strong> HTML tags are escaped</li>
            <li>✅ <strong>Input Validation:</strong> Email format, name characters, message length</li>
            <li>✅ <strong>Rate Limiting:</strong> 1-minute cooldown between submissions</li>
            <li>✅ <strong>Suspicious Pattern Detection:</strong> Blocks javascript:, <script>, etc.</li>
            <li>✅ <strong>Real-time Validation:</strong> Immediate feedback on field blur</li>
        </ul>
    </div>
    
    <div class="test">
        <h3>🧪 Try These Malicious Inputs:</h3>
        <ul>
            <li><code>&lt;script&gt;alert('xss')&lt;/script&gt;</code></li>
            <li><code>javascript:alert('xss')</code></li>
            <li><code>onload="alert('xss')"</code></li>
            <li><code>data:text/html,&lt;script&gt;alert('xss')&lt;/script&gt;</code></li>
            <li><code>Robert'); DROP TABLE users;--</code></li>
        </ul>
        <p><strong>Expected:</strong> All should be sanitized and/or rejected</p>
    </div>

    <script src="js/contact-form.js"></script>
    <script>
        // Override the submitForm method for testing
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('testForm');
            const results = document.getElementById('testResults');
            const output = document.getElementById('sanitizedOutput');
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Get the validator instance
                const validator = new ContactFormValidator();
                
                // Get form data
                const formData = new FormData(form);
                const name = formData.get('name')?.trim() || '';
                const email = formData.get('email')?.trim() || '';
                const message = formData.get('message')?.trim() || '';
                
                // Test sanitization
                const sanitized = {
                    name: validator.sanitizeInput(name),
                    email: validator.sanitizeInput(email),
                    message: validator.sanitizeInput(message)
                };
                
                // Test validation
                const validation = {
                    nameValid: validator.validateName(name),
                    emailValid: validator.validateEmail(email),
                    messageValid: validator.validateMessage(message)
                };
                
                // Show results
                output.innerHTML = `
                    <h5>Original Input:</h5>
                    <pre>Name: ${name}
Email: ${email}
Message: ${message}</pre>
                    
                    <h5>Sanitized Output:</h5>
                    <pre>Name: ${sanitized.name}
Email: ${sanitized.email}
Message: ${sanitized.message}</pre>
                    
                    <h5>Validation Results:</h5>
                    <pre>Name Valid: ${validation.nameValid ? '✅' : '❌'}
Email Valid: ${validation.emailValid ? '✅' : '❌'}
Message Valid: ${validation.messageValid ? '✅' : '❌'}</pre>
                `;
                
                results.style.display = 'block';
                
                console.log('🔒 Security Test Results:', {
                    original: { name, email, message },
                    sanitized,
                    validation
                });
            });
        });
    </script>
</body>
</html>
