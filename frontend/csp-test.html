<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://www.google-analytics.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">>>
    
    <title>Security Headers Test - LearnByShorts</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background: #d4edda; border-color: #c3e6cb; }
        .fail { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>🔒 Security Headers Test</h1>
    
    <div class="test pass">
        <h3>✅ Content Security Policy (CSP)</h3>
        <p>Prevents XSS attacks by controlling resource loading</p>
    </div>
    
    <div class="test" style="background: #fff3cd; border-color: #ffeaa7;">
        <h3>⚠️ X-Frame-Options: Requires HTTP Headers</h3>
        <p>Cannot be set via meta tags - needs server-side configuration</p>
    </div>
    
    <div class="test pass">
        <h3>✅ X-Content-Type-Options: nosniff</h3>
        <p>Prevents MIME type sniffing attacks</p>
    </div>
    
    <div class="test pass">
        <h3>✅ Referrer-Policy: strict-origin-when-cross-origin</h3>
        <p>Controls referrer information sent to other sites</p>
    </div>
    
    <div class="test pass">
        <h3>✅ Permissions-Policy</h3>
        <p>Blocks access to geolocation, microphone, and camera</p>
    </div>
    
    <div class="test pass">
        <h3>✅ Allowed: Inline Styles</h3>
        <p>This page has inline styles - should work with 'unsafe-inline' in style-src</p>
    </div>
    
    <div class="test" id="script-test">
        <h3>🧪 Testing: Inline Scripts</h3>
        <p id="script-result">Testing inline script execution...</p>
    </div>
    
    <div class="test">
        <h3>🧪 Testing: External Font</h3>
        <p style="font-family: 'Inter', sans-serif;">This text uses Google Fonts (should work)</p>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet">
    </div>
    
    <div class="test">
        <h3>🧪 Testing: External Script (CDN)</h3>
        <p id="cdn-result">Testing CDN script loading...</p>
    </div>
    
    <script>
        // Test inline script
        document.getElementById('script-result').innerHTML = '✅ Inline script executed successfully';
        document.getElementById('script-test').className = 'test pass';
        
        // Test external script loading
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js';
        script.onload = function() {
            document.getElementById('cdn-result').innerHTML = '✅ External CDN script loaded successfully';
        };
        script.onerror = function() {
            document.getElementById('cdn-result').innerHTML = '❌ External CDN script blocked by CSP';
        };
        document.head.appendChild(script);
        
        // Test console logging
        console.log('🔒 CSP Test: Console logging works');
        
        // Check security headers
        const securityHeaders = [
            'Content-Security-Policy',
            'X-Frame-Options', 
            'X-Content-Type-Options',
            'Referrer-Policy',
            'Permissions-Policy'
        ];
        
        securityHeaders.forEach(header => {
            const metaTag = document.querySelector(`meta[http-equiv="${header}"]`);
            if (metaTag) {
                console.log(`✅ ${header}: ${metaTag.content}`);
            } else {
                console.log(`❌ ${header}: Not found`);
            }
        });
        
        // Test iframe blocking (should fail)
        console.log('🧪 Testing iframe embedding (should be blocked)...');
        
        // Test geolocation blocking
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                () => console.log('❌ Geolocation allowed (should be blocked)'),
                () => console.log('✅ Geolocation blocked by Permissions-Policy')
            );
        }
    </script>
</body>
</html>
