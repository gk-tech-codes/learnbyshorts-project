# Chain 6.5: Content Completeness Verification

## Input Required
- **Complete Course**: All previous chain outputs
- **Quality Validation Report**: From Chain 6 (`validation-report.json`)

## Prompt

You are a content completeness auditor. Perform comprehensive verification of all course content and identify any missing or incomplete elements.

### Input Context
Load and analyze all generated course content, integration files, and validation results.

### Verification Areas

#### 1. Course Architecture Completeness
```json
{
  "courseArchitecture": {
    "courseMetadata": "Course ID, title, description, duration complete",
    "characterProfiles": "All 3-4 characters fully defined with roles and backgrounds",
    "topicStructure": "6-8 topics with proper progression and dependencies",
    "learningOutcomes": "Measurable, career-relevant outcomes specified",
    "prerequisites": "Clear technical requirements listed"
  }
}
```

#### 2. Character Profile Completeness
```json
{
  "characterProfiles": {
    "characterCount": "3-4 main characters present",
    "characterDetails": "Name, role, background, personality, expertise complete",
    "teamDynamics": "Collaboration patterns and relationships defined",
    "workplaceContext": "Company, industry, challenges, goals specified",
    "modernContext": "Current tools, practices, challenges included"
  }
}
```

#### 3. Topic Content Completeness
```json
{
  "topicContent": {
    "topicCount": "All topics from architecture present",
    "storyStructure": "Each topic has 5 complete sections (story_intro, problem_statement, thinking_process, code_solution, story_conclusion)",
    "characterContinuity": "Characters appear consistently across topics",
    "technicalAccuracy": "Current technology and best practices included",
    "learningProgression": "Each topic builds on previous knowledge"
  }
}
```

#### 4. Integration Completeness
```json
{
  "integrationFiles": {
    "coursesJson": "Course entry added to courses.json",
    "courseDetailJs": "All topics added to CourseDetailPage.js",
    "topicDetailsJson": "All topic content in topic-details.json",
    "homepageTile": "Course visible on homepage",
    "breadcrumbNav": "Navigation code added to topic-story.html"
  }
}
```

### Missing Content Detection

#### Topic Content Verification
For each topic, verify:
- [ ] **Story Title**: Character-driven format "Character's Story: The Hook"
- [ ] **Technical Description**: Clear learning outcomes through story
- [ ] **5 Complete Sections**: All story sections present and substantial
- [ ] **Character Presence**: Established characters featured appropriately
- [ ] **Code Examples**: Production-ready, current technology
- [ ] **Quiz Questions**: Relevant questions with explanations

#### Content Gap Analysis
```bash
#!/bin/bash
# Content Gap Detection Script

COURSE_ID="[course-id]"
MISSING_CONTENT=()

echo "üîç Content Completeness Verification"
echo "===================================="

# Check course architecture
if [ ! -f "course-architecture.json" ]; then
    MISSING_CONTENT+=("Course Architecture")
fi

# Check character profiles
if [ ! -f "character-profiles.json" ]; then
    MISSING_CONTENT+=("Character Profiles")
fi

# Check topic outlines
if [ ! -f "topic-outlines.json" ]; then
    MISSING_CONTENT+=("Topic Outlines")
fi

# Check individual topics
EXPECTED_TOPICS=$(jq -r '.topicOutlines | length' topic-outlines.json 2>/dev/null || echo "0")
ACTUAL_TOPICS=$(ls topic-*.json 2>/dev/null | wc -l || echo "0")

if [ "$ACTUAL_TOPICS" -lt "$EXPECTED_TOPICS" ]; then
    MISSING_CONTENT+=("$((EXPECTED_TOPICS - ACTUAL_TOPICS)) Topic(s)")
fi

# Check integration files
if ! jq -e ".courses[] | select(.id == \"$COURSE_ID\")" frontend/data/courses.json > /dev/null 2>&1; then
    MISSING_CONTENT+=("courses.json entry")
fi

if ! grep -q "$COURSE_ID" frontend/js/pages/CourseDetailPage.js; then
    MISSING_CONTENT+=("CourseDetailPage.js entry")
fi

# Report missing content
if [ ${#MISSING_CONTENT[@]} -eq 0 ]; then
    echo "‚úÖ All content complete!"
else
    echo "‚ùå Missing content detected:"
    for item in "${MISSING_CONTENT[@]}"; do
        echo "   - $item"
    done
fi
```

### Content Regeneration Prompts

#### Missing Course Architecture
If course architecture is incomplete, use this prompt:
```
**REGENERATE COURSE ARCHITECTURE**

Use Chain 1 prompt (01-course-architecture.md) with the following context:
- Course Topic: [COURSE_TOPIC]
- Missing Elements: [SPECIFIC_MISSING_ELEMENTS]
- Requirements: Complete all required fields in JSON structure

Generate complete course-architecture.json with:
- Full course metadata
- 3-4 detailed character profiles
- 6-8 progressive topics with story titles
- Modern technology context
```

#### Missing Character Profiles
If character profiles are incomplete, use this prompt:
```
**REGENERATE CHARACTER PROFILES**

Use Chain 2 prompt (02-character-profiles.md) with the following context:
- Course Architecture: [LOAD_FROM_CHAIN_1]
- Missing Elements: [SPECIFIC_MISSING_ELEMENTS]

Generate complete character-profiles.json with:
- Detailed character backgrounds and personalities
- Team dynamics and relationships
- Modern workplace context
- Character growth arcs
```

#### Missing Topic Content
If topics are missing or incomplete, use this prompt:
```
**REGENERATE TOPIC CONTENT**

Use Chain 4 prompt (04-topic-generation.md) for missing topics:
- Topic Number: [TOPIC_NUMBER]
- Topic Title: [STORY_TITLE]
- Previous Context: [LOAD_PREVIOUS_TOPICS]
- Character Profiles: [LOAD_CHARACTER_PROFILES]

Generate complete topic-[N]-[topic-id].json with:
- 5 complete story sections (400-800 words each)
- Character continuity from previous topics
- Modern technology and current practices
- Production-ready code examples
- Comprehensive quiz questions
```

#### Missing Integration Files
If integration is incomplete, use this prompt:
```
**REGENERATE INTEGRATION FILES**

Use Chain 5 prompt (05-integration-files.md) with the following context:
- All Generated Topics: [LOAD_ALL_TOPICS]
- Course Architecture: [LOAD_COURSE_ARCHITECTURE]
- Missing Elements: [SPECIFIC_MISSING_INTEGRATION]

Generate missing integration files:
- courses.json entry
- CourseDetailPage.js configuration
- topic-details.json entries
- Homepage tile HTML
- Breadcrumb navigation code
```

### Verification Output Structure
```json
{
  "courseId": "course-id",
  "verificationDate": "ISO date",
  "completenessStatus": "COMPLETE/INCOMPLETE",
  "verificationResults": {
    "courseArchitecture": {
      "status": "COMPLETE/INCOMPLETE",
      "missingElements": ["list of missing elements"],
      "regenerationPrompt": "specific prompt to fix issues"
    },
    "characterProfiles": {
      "status": "COMPLETE/INCOMPLETE",
      "missingElements": ["list of missing elements"],
      "regenerationPrompt": "specific prompt to fix issues"
    },
    "topicContent": {
      "status": "COMPLETE/INCOMPLETE",
      "expectedTopics": 7,
      "actualTopics": 5,
      "missingTopics": ["topic-3", "topic-6"],
      "regenerationPrompts": ["specific prompts for each missing topic"]
    },
    "integrationFiles": {
      "status": "COMPLETE/INCOMPLETE",
      "missingFiles": ["courses.json entry", "homepage tile"],
      "regenerationPrompt": "specific prompt to fix integration"
    }
  },
  "nextSteps": [
    "Regenerate missing content using provided prompts",
    "Re-run Chain 6.5 verification after fixes",
    "Proceed to Chain 7 when complete"
  ],
  "regenerationRequired": true
}
```

### Live Testing Script
Use this comprehensive testing script to verify course functionality:

```bash
#!/bin/bash
# Save as: test-course-live.sh
# Usage: ./test-course-live.sh <course-id>

COURSE_ID="$1"
BASE_URL="http://localhost:3000"

# Test results tracking
TESTS_PASSED=0
TESTS_FAILED=0
ERRORS=()

# Function to test URL and content
test_url() {
    local test_name="$1"
    local url="$2" 
    local expected_content="$3"
    local description="$4"
    
    echo "üîç Testing: $test_name"
    HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$url")
    if [ "$HTTP_STATUS" != "200" ]; then
        echo "‚ùå FAIL: HTTP $HTTP_STATUS"
        ERRORS+=("$test_name: HTTP $HTTP_STATUS")
        ((TESTS_FAILED++))
        return 1
    fi
    
    CONTENT=$(curl -s "$url")
    if echo "$CONTENT" | grep -q "$expected_content"; then
        echo "‚úÖ PASS: $description"
        ((TESTS_PASSED++))
    else
        echo "‚ùå FAIL: Expected content not found"
        ERRORS+=("$test_name: Missing expected content")
        ((TESTS_FAILED++))
    fi
}

# Test all critical URLs
test_url "Homepage" "$BASE_URL/index.html" "$COURSE_ID" "Course visible on homepage"
test_url "Course Detail" "$BASE_URL/course-detail.html?id=$COURSE_ID" "course-detail" "Course detail loads"
test_url "First Topic" "$BASE_URL/topic-story.html?course=$COURSE_ID&index=0" "Maya\|David\|Sarah\|Alex" "Story content renders"

# Test JSON APIs
curl -s "$BASE_URL/data/courses.json" | jq -e ".courses[] | select(.id == \"$COURSE_ID\")" > /dev/null
if [ $? -eq 0 ]; then
    echo "‚úÖ PASS: Course in courses.json"
    ((TESTS_PASSED++))
else
    echo "‚ùå FAIL: Course missing from courses.json"
    ERRORS+=("courses.json: Missing course entry")
    ((TESTS_FAILED++))
fi

# Final result
if [ $TESTS_FAILED -eq 0 ]; then
    echo "üéâ ALL TESTS PASSED - Course ready for students!"
    echo "{\"status\": \"COMPLETE\", \"courseId\": \"$COURSE_ID\"}" > course-verification-complete.json
else
    echo "‚ö†Ô∏è $TESTS_FAILED tests failed - fix issues and re-test"
    printf '%s\n' "${ERRORS[@]}" | jq -R . | jq -s . > course-verification-errors.json
fi
```

### Automated Content Verification Script
```bash
#!/bin/bash
# Complete Content Verification and Regeneration Guide

COURSE_ID="$1"
COURSE_TOPIC="$2"

echo "üîç Complete Content Verification for: $COURSE_TOPIC"
echo "=================================================="

# Function to check and provide regeneration prompt
check_and_prompt() {
    local component="$1"
    local file="$2"
    local chain_prompt="$3"
    
    if [ ! -f "$file" ] || [ ! -s "$file" ]; then
        echo "‚ùå Missing: $component"
        echo "üîß Regenerate using: $chain_prompt"
        echo "üìã Context: Course Topic = $COURSE_TOPIC"
        echo ""
        return 1
    else
        echo "‚úÖ Complete: $component"
        return 0
    fi
}

# Verify each component
COMPLETE=true

check_and_prompt "Course Architecture" "course-architecture.json" "Chain 1 (01-course-architecture.md)" || COMPLETE=false
check_and_prompt "Character Profiles" "character-profiles.json" "Chain 2 (02-character-profiles.md)" || COMPLETE=false
check_and_prompt "Topic Outlines" "topic-outlines.json" "Chain 3 (03-topic-outline.md)" || COMPLETE=false

# Check individual topics
if [ -f "topic-outlines.json" ]; then
    EXPECTED_TOPICS=$(jq -r '.topicOutlines | length' topic-outlines.json)
    ACTUAL_TOPICS=$(ls topic-*.json 2>/dev/null | wc -l)
    
    if [ "$ACTUAL_TOPICS" -lt "$EXPECTED_TOPICS" ]; then
        echo "‚ùå Missing: $((EXPECTED_TOPICS - ACTUAL_TOPICS)) topic(s)"
        echo "üîß Regenerate using: Chain 4 (04-topic-generation.md)"
        echo "üìã Generate topics sequentially with character continuity"
        COMPLETE=false
    else
        echo "‚úÖ Complete: All $EXPECTED_TOPICS topics present"
    fi
fi

# Check integration
if ! jq -e ".courses[] | select(.id == \"$COURSE_ID\")" frontend/data/courses.json > /dev/null 2>&1; then
    echo "‚ùå Missing: Integration files"
    echo "üîß Regenerate using: Chain 5 (05-integration-files.md)"
    COMPLETE=false
else
    echo "‚úÖ Complete: Integration files"
fi

# Final status
if [ "$COMPLETE" = true ]; then
    echo ""
    echo "üéâ VERIFICATION COMPLETE - All content present!"
    echo "‚úÖ Ready to proceed to Chain 7: Course Page Generation"
else
    echo ""
    echo "‚ö†Ô∏è  VERIFICATION INCOMPLETE - Regeneration required"
    echo "üìã Use the prompts above to regenerate missing content"
    echo "üîÑ Re-run this verification after regeneration"
fi
```

### Final Step: Topic Crawling and Auto-Completion

After all verification steps, run the comprehensive topic crawling script:

```bash
#!/bin/bash
# Save as: crawl-and-complete-topics.sh
# Usage: ./crawl-and-complete-topics.sh <course-id>

COURSE_ID="$1"
BASE_URL="http://localhost:3000"

# Get expected topics from CourseDetailPage.js
COURSE_JS_CONTENT=$(curl -s "$BASE_URL/js/pages/CourseDetailPage.js")
EXPECTED_TOPICS=$(echo "$COURSE_JS_CONTENT" | grep -A 20 "'$COURSE_ID':" | grep "title:" | wc -l | tr -d ' ')

echo "üï∑Ô∏è Crawling $EXPECTED_TOPICS topics for $COURSE_ID"

COMPLETE_TOPICS=0
INCOMPLETE_TOPICS=0
MISSING_TOPICS=()

# Crawl each topic page
for i in $(seq 0 $((EXPECTED_TOPICS - 1))); do
    TOPIC_URL="$BASE_URL/topic-story.html?course=$COURSE_ID&index=$i"
    
    # Test if topic loads and has content
    TOPIC_CONTENT=$(curl -s "$TOPIC_URL")
    HAS_CHARACTERS=$(echo "$TOPIC_CONTENT" | grep -c "Maya\|David\|Sarah\|Alex")
    IS_LOADING=$(echo "$TOPIC_CONTENT" | grep -c "Loading\.\.\.")
    
    if [ "$IS_LOADING" -gt 0 ] || [ "$HAS_CHARACTERS" -eq 0 ]; then
        echo "‚ùå Topic $((i+1)): INCOMPLETE"
        MISSING_TOPICS+=("$i")
        ((INCOMPLETE_TOPICS++))
        
        # Generate Chain 4 regeneration prompt
        TOPIC_TITLE=$(echo "$COURSE_JS_CONTENT" | grep -A 50 "'$COURSE_ID':" | grep "title:" | sed -n "$((i+1))p" | cut -d'"' -f2)
        
        cat > "regenerate-topic-$((i+1)).md" << EOF
# REGENERATE TOPIC $((i+1)): $TOPIC_TITLE

Use Chain 4 prompt (04-topic-generation.md) with context:
- Topic Index: $i
- Topic Title: $TOPIC_TITLE
- Course ID: $COURSE_ID

Generate complete topic with 5 story sections and character integration.
EOF
        
    else
        echo "‚úÖ Topic $((i+1)): COMPLETE"
        ((COMPLETE_TOPICS++))
    fi
done

echo "üìä Results: $COMPLETE_TOPICS/$EXPECTED_TOPICS complete ($(( COMPLETE_TOPICS * 100 / EXPECTED_TOPICS ))%)"

if [ $INCOMPLETE_TOPICS -eq 0 ]; then
    echo "üéâ ALL TOPICS COMPLETE - Course ready for students!"
    echo '{"status": "COMPLETE"}' > course-verification-complete.json
else
    echo "‚ö†Ô∏è $INCOMPLETE_TOPICS topics need regeneration"
    echo "üîß Use generated regenerate-topic-*.md prompts with Chain 4"
fi
```

This script:
1. **Crawls every topic page** for the course
2. **Checks content completeness** (characters, story sections, no loading states)
3. **Generates Chain 4 prompts** for missing/incomplete topics
4. **Provides completion status** and next steps
5. **Creates verification report** for tracking

## Final Verification Workflow
1. Run content verification checks
2. Run live testing script
3. **Run topic crawling script** ‚Üê NEW FINAL STEP
4. Generate missing topics using provided prompts
5. Re-run crawling until 100% complete
6. Mark Chain 6.5 as COMPLETE

## Output File
Save as: `content-verification-report.json`

## Next Steps
- **If Complete**: Proceed to Chain 7: Course Page Generation
- **If Incomplete**: Use provided regeneration prompts to fix missing content
- **Re-verify**: Run Chain 6.5 again after regeneration until complete

## Integration with Chain Workflow
This verification step ensures no content gaps before final course page generation, maintaining quality and completeness standards.
